<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .search-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 70%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .search-box button {
            width: 28%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 2%;
        }
        
        .weather-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .current-weather {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .temp-display {
            font-size: 60px;
            font-weight: bold;
        }
        
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .forecast-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: white;
        }
        
        .error {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .recent-searches {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .recent-city {
            padding: 5px 15px;
            background: #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .recent-city:hover {
            background: #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: white; text-align: center; margin-bottom: 30px;">
            Weather Dashboard
        </h1>
        
        <div class="search-box">
            <input type="text" id="cityInput" placeholder="Enter city name..." 
                   onkeypress="if(event.key==='Enter') searchWeather()">
            <button onclick="searchWeather()">Search</button>
            <div class="recent-searches" id="recentSearches"></div>
        </div>
        
        <div id="errorMessage"></div>
        <div id="weatherDisplay"></div>
        <div id="forecastDisplay"></div>
    </div>

<script>

  const API_KEY = '1e2cab2a47217dbf0dfda9cccaf8af49'; // Get from openweathermap.org

  // --- utils ---
  function iconFor(weatherMain = '', description = '') {
    const m = (weatherMain || '').toLowerCase();
    const d = (description || '').toLowerCase();
    if (m.includes('clear')) return 'â˜€ï¸';
    if (m.includes('thunder')) return 'â›ˆï¸';
    if (m.includes('drizzle')) return 'ðŸŒ¦ï¸';
    if (m.includes('rain')) return 'ðŸŒ§ï¸';
    if (m.includes('snow')) return 'â„ï¸';
    if (m.includes('cloud')) return 'â˜ï¸';
    if (d.includes('mist') || d.includes('fog') || m.includes('haze')) return 'ðŸŒ«ï¸';
    return 'ðŸŒ';
  }
  const kmh = (mps) => Math.round(mps * 3.6); // m/s -> km/h

  // --- API calls ---
  async function fetchWeather(city) {
    const url =
      `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`City not found (${res.status})`);
    return res.json();
  }

  async function fetchForecast(city) {
    const url =
      `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Forecast error (${res.status})`);
    return res.json();
  }

  // --- render current weather ---
  function displayWeather(data) {
    const el = document.getElementById('weatherDisplay');
    const cityName = `${data.name}, ${data.sys?.country ?? ''}`.trim();
    const temp = Math.round(data.main.temp);
    const desc = data.weather?.[0]?.description ?? '';
    const main = data.weather?.[0]?.main ?? '';
    const icon = iconFor(main, desc);
    const humidity = data.main.humidity;
    const wind = kmh(data.wind.speed);

    el.innerHTML = `
      <div class="weather-card">
        <div class="current-weather">
          <div>
            <h2>${cityName}</h2>
            <div style="color:#555;text-transform:capitalize;">${desc} ${icon}</div>
            <div style="color:#555;">Humidity: ${humidity}% Â· Wind: ${wind} km/h</div>
          </div>
          <div class="temp-display">${temp}Â°C</div>
        </div>
      </div>
    `;
  }

  // --- render 5-day forecast (noon samples) ---
  function displayForecast(data) {
    const el = document.getElementById('forecastDisplay');
    const byNoon = data.list.filter(i => i.dt_txt.includes('12:00:00')).slice(0, 5);

    const items = byNoon.map(item => {
      const date = new Date(item.dt_txt);
      const day = date.toLocaleDateString(undefined, { weekday: 'short' });
      const temp = Math.round(item.main.temp);
      const w = item.weather?.[0] ?? {};
      const icon = iconFor(w.main, w.description);
      return `
        <div class="forecast-item">
          <div style="font-weight:600;">${day}</div>
          <div style="font-size:36px;">${icon}</div>
          <div style="margin-top:6px;">${temp}Â°C</div>
          <div style="font-size:12px;color:#666;text-transform:capitalize;">${w.description ?? ''}</div>
        </div>
      `;
    }).join('');

    el.innerHTML = `
      <div class="weather-card">
        <h3>5-Day Forecast</h3>
        <div class="forecast-grid">${items}</div>
      </div>
    `;
  }

  // --- recent searches ---
  function saveRecentSearch(city) {
    const key = 'recentCities';
    const raw = localStorage.getItem(key);
    const arr = raw ? JSON.parse(raw) : [];
    const next = [city, ...arr.filter(c => c.toLowerCase() !== city.toLowerCase())].slice(0, 5);
    localStorage.setItem(key, JSON.stringify(next));
    loadRecentSearches();
  }

  function loadRecentSearches() {
    const box = document.getElementById('recentSearches');
    const raw = localStorage.getItem('recentCities');
    const arr = raw ? JSON.parse(raw) : [];
    box.innerHTML = arr
      .map(c => `<span class="recent-city" onclick="quickSearch('${c.replace(/'/g, "\\'")}')">${c}</span>`)
      .join('');
  }

  function quickSearch(city) {
    document.getElementById('cityInput').value = city;
    searchWeather();
  }

  // --- error helpers ---
  function showError(message) {
    document.getElementById('errorMessage').innerHTML =
      `<div class="error">${message}</div>`;
  }
  function clearError() {
    document.getElementById('errorMessage').innerHTML = '';
  }

  // --- main flow ---
  async function searchWeather() {
    const input = document.getElementById('cityInput');
    const city = input.value.trim();
    if (!city) { showError('Please enter a city.'); return; }

    // simple loading state
    clearError();
    document.getElementById('weatherDisplay').innerHTML =
      `<div class="weather-card" style="text-align:center;">Loadingâ€¦</div>`;
    document.getElementById('forecastDisplay').innerHTML = '';

    try {
      const [current, forecast] = await Promise.all([
        fetchWeather(city),
        fetchForecast(city)
      ]);
      displayWeather(current);
      displayForecast(forecast);
      saveRecentSearch(city);
    } catch (err) {
      showError(err.message || 'Something went wrong fetching weather.');
      document.getElementById('weatherDisplay').innerHTML = '';
      document.getElementById('forecastDisplay').innerHTML = '';
    }
  }

  // Initialize
  loadRecentSearches();
</script>
</body>
</html>